<script> @minify
// --------------------------------------------------------------------------
(function( $, io, document, window, undefined ){
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // Contract real estate building
    // ----------------------------------------------------------------------
    Vue.component( 'contract-building', {
        // ------------------------------------------------------------------
        props: [ 'value', 'index', 'parent', 'disabled', 'completed' ],
        template: '#contract-building',
        // ------------------------------------------------------------------

        // ------------------------------------------------------------------
        // Reactive data
        // ------------------------------------------------------------------
        data: function(){
            // --------------------------------------------------------------
            var data = {
                entry: this.value,
            };
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            return data;
            // --------------------------------------------------------------
        },
        // ------------------------------------------------------------------

        // ------------------------------------------------------------------
        // Computed properties
        // ------------------------------------------------------------------
        computed: {
            // --------------------------------------------------------------
            prefix: function(){
                var entry = this.entry;
                var prefix = 'new-contract-product-building' +this.index;
                return entry.id ? 'contract-product-building' +entry.id+ '-' : prefix;
            },
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Find out if this section is disabled
            // --------------------------------------------------------------
            isDisabled: function(){
                return this.disabled || this.isCompleted;
            },
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Find out if this group is completed
            // --------------------------------------------------------------
            isCompleted: function(){ return this.completed },
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Get number object of the building
            // --------------------------------------------------------------
            number: function(){
                var number = {}; var parent = this.parent;
                if( parent ){
                    number.first = io.get( parent, 'building_number_first' );
                    number.second = io.get( parent, 'building_number_second' );
                    number.third = io.get( parent, 'building_number_third' );
                } return number;
            },
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Get string formatted number of the building
            // --------------------------------------------------------------
            numberLabel: function(){
                var number = this.number;
                let number_third = number.third ? 'の' + number.third : '';
                return number.first+ '番' +number.second+ number_third;
            },
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Get parcel city label of the building
            // --------------------------------------------------------------
            cityLabel: function(){
                var result = []; var parent = this.parent;
                if( parent ){
                    // ------------------------------------------------------
                    var city = '';
                    var parcelCity = parent.parcel_city;
                    if( -1 === parcelCity ) city = '';
                    else if( 0 <= parcelCity && parent.city ){
                        city = io.get( parent.city, 'name' );
                    } result.push( city );
                    // ------------------------------------------------------

                    // ------------------------------------------------------
                    if( parent.parcel_city_extra ) result.push( parent.parcel_city_extra );
                    if( parent.parcel_town ) result.push( parent.parcel_town );
                    // ------------------------------------------------------
                } return result.join('');
            },
            // --------------------------------------------------------------
        },
        // ------------------------------------------------------------------

        // ------------------------------------------------------------------
        // Watchers
        // ------------------------------------------------------------------
        watch: {
            // --------------------------------------------------------------
            numberLabel: {
                immediate: true,
                handler: function( value ){
                    Vue.set( this.entry, 'house_number', value );
                }
            },
            // --------------------------------------------------------------
            cityLabel: {
                immediate: true,
                handler: function( value ){
                    Vue.set( this.entry, 'building_parcel', value );
                }
            }
            // --------------------------------------------------------------
        },
        // ------------------------------------------------------------------

        // ------------------------------------------------------------------
        // Component methods
        // ------------------------------------------------------------------
        methods: {}
        // ------------------------------------------------------------------
    });
    // ----------------------------------------------------------------------
}( jQuery, _, document, window ));
// --------------------------------------------------------------------------
@endminify </script>

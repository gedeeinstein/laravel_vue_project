<?php
// --------------------------------------------------------------------------
namespace App\Http\Controllers\Api;
// --------------------------------------------------------------------------
use App\Models\User;
// --------------------------------------------------------------------------
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
// --------------------------------------------------------------------------

// --------------------------------------------------------------------------
class UserApiController extends Controller {
	// ----------------------------------------------------------------------

	// ----------------------------------------------------------------------
	// Verify duplicate user-email 
	// ----------------------------------------------------------------------
	public function email( Request $request ){
		// ------------------------------------------------------------------
		$result = (object) array( 'verified' => true );
		if( empty( $request->email )){ $result->verified = false; $result->error = 'missing'; }
		// ------------------------------------------------------------------
		$result->email = $request->email;

		// ------------------------------------------------------------------
		$query = User::where( 'email', $request->email );
		if( !empty( $request->user )) $query = $query->where( 'id', '<>', $request->user );
		$users = $query->get();
		// ------------------------------------------------------------------
		if( !$users->isEmpty()){
			$result->verified = false;
			$result->error = 'registered';
		}
		// ------------------------------------------------------------------

		// ------------------------------------------------------------------
		return response()->json( $result );
		// ------------------------------------------------------------------
	}
	// ----------------------------------------------------------------------
}


<?php
// --------------------------------------------------------------------------
namespace App\Http\Middleware;
use Closure;
// --------------------------------------------------------------------------
use App\Models\RequestInspection as Inspection;
// --------------------------------------------------------------------------

// --------------------------------------------------------------------------
class GlobalPreset {
    // ----------------------------------------------------------------------
    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    // ----------------------------------------------------------------------
    public function handle( $request, Closure $next ){
        // ------------------------------------------------------------------
        $preset = new \stdClass;
        // ------------------------------------------------------------------

        // ------------------------------------------------------------------
        // Inspection request data
        // ------------------------------------------------------------------
        $inspection = new \stdClass;
        $preset->inspection = $inspection;
        // ------------------------------------------------------------------
        $query = Inspection::where( 'examination', 1 )
            ->where( 'active', true );
        $inspection->unapproved = $query->get();
        // ------------------------------------------------------------------
        
        // ------------------------------------------------------------------
        \View::share( 'preset', $preset );
        return $next( $request );
        // ------------------------------------------------------------------
    }
    // ----------------------------------------------------------------------
}

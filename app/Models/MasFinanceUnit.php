<?php
// --------------------------------------------------------------------------
namespace App\Models;
// --------------------------------------------------------------------------
use Carbon\Carbon;
use Illuminate\Database\Eloquent\Model;
// --------------------------------------------------------------------------
use App\Models\MasFinance as Finance;
use App\Models\MasFinanceUnitMoney as UnitMoney;
use App\Models\MasFinanceRepayment as Repayment;
// --------------------------------------------------------------------------

// --------------------------------------------------------------------------
class MasFinanceUnit extends Model {
    // ----------------------------------------------------------------------
    protected $table = 'mas_finance_units';
    protected $guarded = array( 'id' );
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // Master Finance which this table belongs to
    // ----------------------------------------------------------------------
    public function finance(){
        return $this->belongsTo( Finance::class );
    }
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // It has many mas_finance_unit_moneys
    // ----------------------------------------------------------------------
    public function moneys(){
        return $this->hasMany( UnitMoney::class );
    }
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // It has many mas_finance_unit_moneys
    // ----------------------------------------------------------------------
    public function repayments(){
        return $this->hasMany( Repayment::class );
    }
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // with repayment where type sales
    // ----------------------------------------------------------------------
    public function repaymentSales(){
        return $this->repayments()->where('data_type', 'sales');
    }
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // with repayment where type others
    // ----------------------------------------------------------------------
    public function repaymentOthers(){
        return $this->repayments()->where('data_type', 'others');
    }
    // ----------------------------------------------------------------------

    // ----------------------------------------------------------------------
    // Mutator to format date to Y/m/d
    // ----------------------------------------------------------------------
    public function getLoanPeriodDateAttribute($value){
        $date = $value;
        if ($value) $date = Carbon::parse($value)->format('Y/m/d');
        return $date;
    }
    // ----------------------------------------------------------------------
}

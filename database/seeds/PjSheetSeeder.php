<?php
// --------------------------------------------------------------------------
use App\Models\Project;
use App\Models\PjSheet;
// --------------------------------------------------------------------------
use Faker\Factory as Faker;
use Illuminate\Database\Seeder;
// --------------------------------------------------------------------------

// --------------------------------------------------------------------------
class PjSheetSeeder extends Seeder {
    // ----------------------------------------------------------------------
    public function run(){
        // ------------------------------------------------------------------
        $faker = Faker::create('ja_JP');
        Project::all()->each( function( $project ) use( $faker ){
            // --------------------------------------------------------------
            // Create Sheets
            // --------------------------------------------------------------
            $append = array( 'project_id' => $project->id );
            $number = $faker->numberBetween( 2, 4 );
            // --------------------------------------------------------------
            $sheets = factory( PjSheet::class, $number )->create( $append );
            $sheets->each( function( $sheet, $index ){
                // ----------------------------------------------------------
                $order = $index +1;
                $sheet->tab_index = $order;
                $sheet->name = "Sheet {$order}";
                // ----------------------------------------------------------
                if( !$index ) $sheet->is_reflecting_in_budget = true;
                // ----------------------------------------------------------
                $sheet->save();
                // ----------------------------------------------------------
            });
            // --------------------------------------------------------------
        });
        // ------------------------------------------------------------------
    }
    // ----------------------------------------------------------------------
}
// --------------------------------------------------------------------------
<?php
// --------------------------------------------------------------------------
use Illuminate\Database\Seeder;
// --------------------------------------------------------------------------
use App\Models\Project;
use App\Models\MasFinance as Finance;
use App\Models\MasFinanceExpense as FinanceExpense;
use App\Models\MasFinancePurchaseAccountMain as Account;
// --------------------------------------------------------------------------

// --------------------------------------------------------------------------
class PjExpenseSeeder extends Seeder {
    // ----------------------------------------------------------------------
    // private $project_id = [ 1, 2 ];
    private $mas_expenses = [
        [
            'count' => 2,
            'index' => 'ア',
            'name'  => '金利負担',
        ], [
            'count' => 1,
            'index' => 'イ',
            'name'  => '銀行手数料',
        ], [
            'count' => 3,
            'index' => 'ウ',
            'name'  => '印紙(手形)',
        ], [
            'count' => 1,
            'index' => 'エ',
            'name'  => 'テスト1',
        ], [
            'count' => 1,
            'index' => 'オ',
            'name'  => 'テスト2',
        ]
    ];
    // ----------------------------------------------------------------------


    // ----------------------------------------------------------------------
    /**
     * Run the database seeds.
     *
     * @return void
     */
    // ----------------------------------------------------------------------
    public function run(){
        // ------------------------------------------------------------------
        $projects = Project::all();
        $projects->each( function( $project ){
            // --------------------------------------------------------------
            // $faker = Faker::create('ja_JP');
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Master Finance
            // --------------------------------------------------------------
            $finance = factory( Finance::class )->create([
                'project_id' => $project->id
            ]);
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Create Finance Expnese Based on list
            // --------------------------------------------------------------
            foreach( $this->mas_expenses as $expense ){
                $expense = (object) $expense;
                factory( FinanceExpense::class, $expense->count )->create([
                    'category_index' => $expense->index,
                    'display_name'   => $expense->name,
                    'mas_finance_id' => $finance->id
                ]);
            }
            // --------------------------------------------------------------

            // --------------------------------------------------------------
            // Create Finance Purchase Accounts
            // --------------------------------------------------------------
            factory( Account::class, 3 )->create([
                'mas_finance_id' => $finance->id
            ]);
            // --------------------------------------------------------------
        });
        // ------------------------------------------------------------------
    }
    // ----------------------------------------------------------------------
}
// --------------------------------------------------------------------------
